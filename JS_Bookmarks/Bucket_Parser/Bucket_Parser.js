javascript:(()=>{function human(x){if(!x)return"0 B";let u=["B","KB","MB","GB","TB"],i=Math.floor(Math.log(x)/Math.log(1024));return(x/Math.pow(1024,i)).toFixed(2)+" "+u[i]}function fmtDate(s){if(!s)return"";let d=new Date(s);return isNaN(d)?"":d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")+" "+String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")+":"+String(d.getSeconds()).padStart(2)}function cat(k){if(k.endsWith("/"))return"Directories";let ext=k.split(".").pop().toLowerCase();if(/^(zip|rar|7z|tar|gz|bz2)$/i.test(ext))return"Archives";if(/^(jpg|jpeg|png|gif|bmp|svg|webp)$/i.test(ext))return"Images";if(/^(html|htm)$/i.test(ext))return"HTML";if(/^(js)$/i.test(ext))return"JavaScript";if(/^(css)$/i.test(ext))return"CSS";if(/^(ttf|otf|woff|woff2)$/i.test(ext))return"Fonts";if(/^(mp4|mkv|avi|mov|webm)$/i.test(ext))return"Video";if(/^(mp3|wav|ogg)$/i.test(ext))return"Audio";return"Other"}fetch(location.href).then(r=>r.text()).then(raw=>{const xml=(new DOMParser).parseFromString(raw,"application/xml");const contents=[...xml.getElementsByTagName("Contents")];if(!contents.length){alert("No <Contents> elements found.");return;}let base=location.origin+location.pathname.replace(/[^/]*$/,"");function enc(k){return encodeURI(k);}let groups={};contents.forEach(c=>{let k=c.getElementsByTagName("Key")[0]?.textContent||"";let size=parseInt(c.getElementsByTagName("Size")[0]?.textContent)||0;let date=c.getElementsByTagName("LastModified")[0]?.textContent||"";let owner=c.getElementsByTagName("ID")[0]?.textContent||"";let storage=c.getElementsByTagName("StorageClass")[0]?.textContent||"";let g=cat(k);if(!groups[g])groups[g]=[];groups[g].push({k,size,date,owner,storage});});let html=`<html><head><title>S3 Objects</title><style>table{border-collapse:separate;border-spacing:10px 0;}th,td{padding:6px;border-bottom:1px solid #444;}th{position:relative;background:#222;color:#eee;}th .resizer{position:absolute;right:-5px;top:0;width:10px;height:100%;cursor:col-resize;background:rgba(255,255,255,0.2);}th .resizer:hover{background:rgba(255,255,255,0.5);}</style></head><body style="font:14px sans-serif;background:#111;color:#eee"><h2>S3 Objects (${contents.length})</h2>`;Object.keys(groups).forEach(g=>{let arr=groups[g];html+=`<h3 style="cursor:pointer;background:#333;padding:6px" onclick="let n=this.nextElementSibling;n.style.display=n.style.display==='none'?'block':'none'">${g} (${arr.length})</h3><div style="display:none"><table class="tbl" style="width:100%"><thead><tr><th data-type="str">Key<div class="resizer"></div></th><th data-type="num">Size<div class="resizer"></div></th><th data-type="date">Last Modified<div class="resizer"></div></th><th data-type="str">Owner ID<div class="resizer"></div></th><th data-type="str">StorageClass<div class="resizer"></div></th></tr></thead><tbody>`;arr.forEach(o=>{html+=`<tr><td data-val="${o.k}"><a style="color:#4ea3ff;text-decoration:none" href="${o.k.endsWith("/")?"#":base+enc(o.k)}" target="_blank">${o.k}</a></td><td data-val="${o.size}" style="text-align:right">${human(o.size)}</td><td data-val="${o.date}">${fmtDate(o.date)}</td><td data-val="${o.owner}">${o.owner}</td><td data-val="${o.storage}">${o.storage}</td></tr>`});html+=`</tbody></table></div>`});html+=`<script>(function(){function getVal(td,type){return type==='num'?parseFloat(td.dataset.val||0):type==='date'?new Date(td.dataset.val||0):td.dataset.val.toLowerCase();}document.querySelectorAll("table").forEach(tbl=>{tbl.querySelectorAll("th").forEach((th,i)=>{let asc=true;th.addEventListener("click",e=>{if(e.target.classList.contains('resizer'))return;let rows=[...tbl.tBodies[0].rows];rows.sort((a,b)=>{let v1=getVal(a.cells[i],th.dataset.type),v2=getVal(b.cells[i],th.dataset.type);return v1>v2?asc?1:-1:v1<v2?asc?-1:1:0});rows.forEach(tr=>tbl.tBodies[0].appendChild(tr));asc=!asc;});let resizer=th.querySelector(".resizer");let startX,startW;resizer.addEventListener("mousedown",e=>{startX=e.pageX;startW=th.offsetWidth;function onMove(e2){th.style.width=(startW+(e2.pageX-startX))+'px';}function onUp(){document.removeEventListener('mousemove',onMove);document.removeEventListener('mouseup',onUp);}document.addEventListener('mousemove',onMove);document.addEventListener('mouseup',onUp);});});});})();</script></body></html>`;const w=window.open();w.document.write(html);w.document.close();});})();
